<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../css/all_dingdan.css"/>
    <style>
    	body{
    		
    	}
    </style>
</head>
<body>
	<div id="main">
		<div class="jiazai"><div class="left"><img src="../image/login1.gif" /></div><div class="right">加载中...</div></div>
		<!--<div class="list">
			<div class="header"><div class="left">订单已提交   2016-02-23  15:23:23</div><div class="right" tapmode="" onclick="fdel_order_pan(0);"></div></div>
			<div class="content">
				<div class="left"><img src="../image/shanghu_logo.png" /></div>
				<div class="right">
					<div class="shopName">大胡子的烧烤</div>
					<div class="goods_list">
						<div class="goodsName ccyc">大胡子商品</div>
						<div class="goodsNum">x1</div>
					</div>
					<div class="goods_list">
						<div class="goodsName ccyc">大胡子商品</div>
						<div class="goodsNum">x1</div>
					</div>
					<div class="goods_list">
						<div class="goodsName ccyc">大胡子商品</div>
						<div class="goodsNum">x1</div>
					</div>
				</div>
			</div>
			<div class="footer">共3份，实付<span>￥35.00</span></div>
		</div>
		<div class="shangjia">
			<div class="min-title">
				<span class="t2"></span><span class="t1">大吉祥天</span><span class="t4">服务已完成</span>
			</div>
			<div class="goods goods2" tapmode="a0" onclick="fopen_dingdan_xx();">
				<div class="title2 ccyc">不要看我，我是魔性标题</div>
				<div class="con">南方的小镇，阴雨的冬天内容内容。南方的小镇，阴雨的冬天内容内容。南方的小镇，阴雨的冬天内容内容。南方的小镇，阴雨的冬天内容内容。南方的小镇，阴雨的冬天内容内容。南方的小镇，阴雨的冬天内容内容。南方的小镇，阴雨的冬天内容内容。</div>
			</div>
			<div class="caozuo">
				<div tapmode="del_on" class="del">去支付</div>
				<div tapmode="a" class="pinglun">价钱：￥233.00</div>
			</div>
		</div>
		<div class="list">
			<div class="header"><div class="left">订单已提交   2016-02-23  15:23:23</div><div class="right" tapmode="" onclick="fdel_order_pan(0);"></div></div>
			<div class="content">
				<div class="left"><img src="../image/shanghu_logo.png" /></div>
				<div class="right">
					<div class="shopName">大胡子的烧烤</div>
					<div class="goods_list">
						<div class="goodsName">大胡子商品</div>
						<div class="goodsNum">x1</div>
					</div>
					<div class="goods_list">
						<div class="goodsName">大胡子商品</div>
						<div class="goodsNum">x1</div>
					</div>
					<div class="goods_list">
						<div class="goodsName">大胡子商品</div>
						<div class="goodsNum">x1</div>
					</div>
				</div>
			</div>
			<div class="footer">共3份，实付<span>￥35.00</span></div>
		</div>
		<div class="add_data" tapmode="add_data_on">加载更多>></div>
		<div class="no_data">没有更多数据</div>-->
		<!--<div class="shangjia">
			<div class="min-title">
				<span class="t2"></span><span class="t1">大吉祥天</span><span class="t4">等待付款</span>
			</div>
			<div class="goods" tapmode="a0" onclick="fopen_dingdan_xx();">
				<div class="goods_left"><img src="../image/sp_5.png" /></div>
				<div class="goods_cen"><div class="goods_title">衣锦 2015冬装新款羽绒服奢华大毛领韩中长款金色羽绒服</div></div>
			</div>
			<div class="caozuo">
				<div tapmode="del_on" class="del">去支付</div>
				<div tapmode="a" class="pinglun">实付款：￥233.00</div>
			</div>
		</div>
		<div class="shangjia">
			<div class="min-title">
				<span class="t2"></span><span class="t1">大吉祥天</span><span class="t4">等待发货</span>
			</div>
			<div class="goods" tapmode="a0" onclick="fopen_dingdan_xx();">
				<div class="goods_left"><img src="../image/sp_5.png" /></div>
				<div class="goods_cen"><div class="goods_title">衣锦 2015冬装新款羽绒服奢华大毛领韩中长款金色羽绒服</div></div>
			</div>
			<div class="caozuo">
				<div tapmode="del_on" class="del">确认收货</div>
				<div tapmode="look_wl_on" class="look_wl" onclick="fopen_wuliu();">查看物流</div>
				<div tapmode="a" class="pinglun">实付款：￥233.00</div>
			</div>
		</div>
		<div class="shangjia">
			<div class="yichengjiao"></div>
			<div class="min-title">
				<span class="t2"></span><span class="t1">大吉祥天</span><span class="t3" tapmode="a"></span>
			</div>
			<div class="goods" tapmode="a0" onclick="fopen_dingdan_xx();">
				<div class="goods_left"><img src="../image/sp_5.png" /></div>
				<div class="goods_cen"><div class="goods_title">衣锦 2015冬装新款羽绒服奢华大毛领韩中长款金色羽绒服</div></div>
			</div>
			<div class="caozuo">
				<div tapmode="del_on" class="del">去评价</div>
				<div tapmode="look_wl_on" class="look_wl" onclick="fopen_wuliu();">查看物流</div>
				<div tapmode="a" class="pinglun">实付款：￥233.00</div>
			</div>
		</div>
		<div class="shangjia">
			<div class="yichengjiao"></div>
			<div class="min-title">
				<span class="t2"></span><span class="t1">大吉祥天</span><span class="t3" tapmode="a"></span>
			</div>
			<div class="goods" tapmode="a0" onclick="fopen_dingdan_xx();">
				<div class="goods_left"><img src="../image/sp_5.png" /></div>
				<div class="goods_cen"><div class="goods_title">衣锦 2015冬装新款羽绒服奢华大毛领韩中长款金色羽绒服</div></div>
			</div>
			<div class="caozuo">
				<div tapmode="del_on" class="del">追加评价</div>
				<div tapmode="look_wl_on" class="look_wl" onclick="fopen_wuliu();">查看物流</div>
				<div tapmode="a" class="pinglun">实付款：￥233.00</div>
			</div>
		</div>-->
		<div id="statement" class="f"></div>
	</div>
	
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/jquery190.js"></script>
<script type="text/javascript" src="../script/config.js"></script>
<script type="text/javascript">
	apiready = function(){
		
		fget_all_dingdan();
		//下拉刷新
			api.setRefreshHeaderInfo({
			    visible: true,
			    loadingImg: '',
			    bgColor: '#f2f2f2',
			    textColor: '#fff',
			    textDown: '下拉刷新...',
			    textUp: '松开刷新...',
			    showTime: true
			}, function(ret, err){
			    //从服务器加载数据，完成后调用api.refreshHeaderLoadDone()方法恢复组件到默认状态
			    page=0;
				look=0;
			    fget_all_dingdan();
				
			    //api.refreshHeaderLoadDone();
			    api.parseTapmode();
			});
		api.addEventListener({
			name:'scrolltobottom',
			extra:{
			    threshold:10//设置距离底部多少距离时触发，默认值为0，数字类型   
			}},function(ret, err){
			if(look==0) fget_all_dingdan();
		});
	};
	var page=0;
	var look=0;
	function fopen_wuliu(orderId)
	{
		api.openWin({
		    name: 'wuliu_xx_header',
		    url: 'wuliu_xx_header.html',
		    pageParam:{
		    	orderId:orderId
		    }
	    });
	}
	function fopen_dingdan_xx(orderId)
	{
//		api.openWin({
//		    name: 'dingdan_xx_header',
//		    url: 'dingdan_xx_header.html'
//	    });
		api.openWin({
	        name: 'dingdan_xx2_header',
	        url: 'dingdan_xx2_header.html',
	        pageParam:{
	        	id:orderId
	        }
        });
	}
	function fgo_pay(orderId)
	{
		var ret='[{"orderId":'+orderId+'}]';
		ret=eval('('+ret+')');
		api.openWin({
			name: 'zhifu_header',
			url: 'zhifu_header.html',
			pageParam:{
			       json:ret
			}
		});
	}
	function fopen_goods(goodsId)
	{
	
	}
	function fopen_shangjia(shopId,shopName,shopImg)
	{
		api.openWin({
		    name: 'dianpu',
		    url: 'dianpu.html',
		    pageParam:{
		    	shopId:shopId,
		    	shopName:shopName,
		    	shopImg:shopImg
		    }
	    });
	}
//	function fget_all_dingdan()
//	{
//			//api.showProgress({title:'加载中...'});
//			var user_id=$api.getStorage('user_id');
//			api.ajax({
//	            url: YAH_ajax_name+'get_all_dingdan.php',
//	            method: 'post',
//	            cache: false,
//	            timeout: 30,
//	            dataType: 'json',
//	            returnAll:false,
//	            data:{
//	                values: {
//	                	user_id:user_id
//	                }
//	            }
//	        },function(ret,err){
//	        	//api.hideProgress();//隐藏加载进度框
//	            if (ret) {
//	            	//alert("ret:"+ret.length);
//	                 var i,j,t=0;
//	                 var tiao=new Array();//多少条订单
//	                 var sj_name=new Array();//商家名字
//	                 var sj_img=new Array();//商家头像
//	                 var sj_id=new Array();//商家id
//	                 var dd_money=new Array();//订单实付款
//	                 var orderStatus=new Array();//订单状态
//	                 var orderId=new Array();//订单id
//	                 var pan_tiao=0;
//	                 for(i=0;i<ret.length;i++)
//	                 {
//	                 	if(ret[i].orderId!=pan_tiao)
//	                 	{
//	                 		tiao[t]=ret[i].orderId;
//	                 		sj_name[t]=ret[i].shopName;
//	                 		sj_img[t]=ret[i].shopImg;
//	                 		sj_id[t]=ret[i].shopId;
//	                 		dd_money[t]=ret[i].needPay;
//	                 		orderStatus[t]=ret[i].orderStatus;
//	                 		orderId[t]=ret[i].orderId;
//	                 		pan_tiao=ret[i].orderunique;
//	                 		t++;
//	                 	}
//	                 }
//	                 var html='';
//	                 for(i=0;i<tiao.length;i++)
//	                 {
//	                 	var tishi='';
//	                 	if(orderStatus[i]==-2) tishi='未付款';
//	                 	if(orderStatus[i]==-1) tishi='已取消';
//	                 	if(orderStatus[i]==0) tishi='已提交';
//	                 	if(orderStatus[i]==1) tishi='已受理';
//	                 	if(orderStatus[i]==2) tishi='打包中';
//	                 	if(orderStatus[i]==3) tishi='配送中';
//	                 	if(orderStatus[i]==4) tishi='已完成';
//	                 	html+='<div class="list">';
//						html+='	<div class="header"><div class="left">订单'+tishi+'   '+ret[i].xiadan_time+'</div><div class="right" tapmode="" onclick="event.cancelBubble = true;fdel_order_pan('+tiao[i]+');"></div></div>';
//						html+='	<div class="content">';
//						html+='		<div class="left" tapmode="" onclick="fopen_shangjia(\''+sj_id[i]+'\',\''+sj_name[i]+'\',\''+sj_img[i]+'\')"><img src="'+YAH_web+'/'+sj_img[i]+'" /></div>';
//						html+='		<div class="right" tapmode="" onclick="fopen_dingdan_xx('+tiao[i]+')">';
//						html+='			<div class="shopName">'+sj_name[i]+'</div>';
//						t=0;
//						for(j=0;j<ret.length;j++)
//		                {
//		                 	if(tiao[i]==ret[j].orderId)
//		                 	{
//								html+='			<div class="goods_list">';
//								html+='				<div class="goodsName ccyc">'+ret[j].goodsName+'</div>';
//								html+='				<div class="goodsNum">x'+ret[j].goodsNums+'</div>';
//								html+='			</div>';
//								t++;
//							}
//						}
//						html+='		</div>';
//						html+='	</div>';
//						html+='	<div class="footer">共'+t+'份，实付<span>￥'+dd_money[i]+'</span></div>';
//						html+='</div>';
//	                 }
//	                 document.getElementById("main").innerHTML=html;
//	                 api.parseTapmode();
//	            }else {
//	            	//fduanwang();
//	            	document.getElementById("main").innerHTML='<div style="text-align: center;line-height: 50px;">暂无订单</div>';
////					api.alert({
////		                msg:('错误码：'+err.code+'；错误信息：'+err.msg+'网络状态码：'+err.statusCode)
////		            });
//	            };
//	            api.refreshHeaderLoadDone();
//	            api.hideProgress();//隐藏加载进度框
//	        });
//	}
	function fset_page()
	{
		page=0;
		look=0;
	}
	function fget_all_dingdan()
	{
		var login=$api.getStorage('login');
		if(login==undefined || login==0 || login=='0')
		{
			document.getElementById("main").innerHTML='<div style="text-align: center;line-height: 50px;">请先登录</div>';
			api.refreshHeaderLoadDone();
			page=-1;
			return;
		}
		look=1;
		if(page<0) {api.refreshHeaderLoadDone();return;}
		$('.add_data').remove();
		$('#main').append('<div class="jiazai" style="background-color:#f2f2f2;"><div class="left"><img src="../image/login1.gif" /></div><div class="right">加载中...</div></div>');
		var user_id=$api.getStorage('user_id');
			api.ajax({
	            url: YAH_ajax_name+'get_all_dingdan3.php',
	            method: 'post',
	            cache: false,
	            timeout: 30,
	            dataType: 'json',
	            returnAll:false,
	            data:{
	                values: {
	                	user_id:user_id,
	                	start:page
	                }
	            }
	        },function(ret,err){
	        	look=0;
	        	//api.hideProgress();//隐藏加载进度框
	            if (ret) {
	            	var html='';
	            	for(var i=0;i<ret.length;i++)
	            	{
	            		if(ret[i].dd_type=="yungou")
	            		{
	            			var lxzt='';
	            			if(ret[i].orderStatus==-2) lxzt='weifukuan';
	            			else if(ret[i].orderStatus==0 || ret[i].orderStatus==1 || ret[i].orderStatus==2) lxzt='jinxingzhong';
	            			else if(ret[i].orderStatus==3) lxzt='jinxingzhong';
	            			else if(ret[i].orderStatus==4) lxzt='yiwancheng';
	            			else if(ret[i].isRefund==2) lxzt='yiwancheng';
	            			else if(ret[i].isRefund==1) lxzt='jinxingzhong';
							
							html+='<div class="list '+lxzt+'">';
							html+='	<div class="header"><div class="left">'+ret[i].msg+'   '+ret[i].xiadan_time+'</div>';
							if(ret[i].orderStatus==-2 || ret[i].orderStatus==4 || ret[i].isRefund==2) html+='<div class="right" tapmode="" onclick="event.cancelBubble = true;fdel_order_pan('+ret[i].orderId+');"></div>';
							html+='</div>';
							html+='	<div class="content">';
							html+='		<div class="left" tapmode="" onclick="fopen_shangjia(\''+ret[i].shopId+'\',\''+ret[i].shopName+'\',\''+ret[i].shopImg+'\')"><img src="'+YAH_web+'/'+ret[i].shopImg+'" /></div>';
							if(ret[i].orderStatus==0 || ret[i].orderStatus==1 || ret[i].orderStatus==2 || ret[i].orderStatus==3 || ret[i].orderStatus==4) html+='		<div class="right" tapmode="" onclick="fopen_dingdan_xx('+ret[i].orderId+')">';
							else if(ret[i].orderStatus==-7 || ret[i].orderStatus==-6 || ret[i].orderStatus==-3 || ret[i].orderStatus==-1 || ret[i].orderStatus==-4) html+='		<div class="right" tapmode="" onclick="fopen_tuikuan_xx('+ret[i].orderId+')">';
							else html+='		<div class="right" tapmode="" onclick="fopen_dingdan_xx('+ret[i].orderId+')">';
							html+='			<div class="shopName">'+ret[i].shopName+'</div>';
							for(var j=0;j<ret[i]['list'].length;j++)
			                {
								html+='			<div class="goods_list">';
								html+='				<div class="goodsName ccyc">'+ret[i]['list'][j].goodsName+' '+ret[i]['list'][j].goodsAttrName+'</div>';
								html+='				<div class="goodsNum">x'+ret[i]['list'][j].goodsNums+'</div>';
								html+='			</div>';
							}
							html+='		</div>';
							html+='	</div>';
							html+='	<div class="footer">共'+ret[i].num+'份，实付<span>￥'+ret[i].needPay+'</span></div>';
							html+='</div>';
	            		}
	            		else if(ret[i].dd_type=="weibang")
	            		{
	            			var lxzt='';
	            			var html2='';
	            			html2+='<div tapmode="del_on" class="del" onclick="fover(\''+ret[i].orderId+'\',\''+ret[i].userId+'\');">已完成微帮</div>';
	            			html2+='<div tapmode="look_wl_on" class="look_wl" onclick="fqxdd(\''+ret[i].orderId+'\',\''+ret[i].userId+'\');">取消订单</div>';
	            			if(ret[i].orderStatus==0)
	            			{
	            				if(ret[i].isPay==0 || ret[i].isPay=='0')
		            			{
		            				if(ret[i].zt==1 || ret[i].zt==4)
		            				{
		            					html2='<div tapmode="del_on" class="del" onclick="fgo_pay_wb('+ret[i].orderId+');">去支付</div>';
		            				}
		            				else
		            				{
		            					html2='<div tapmode="look_wl_on" class="look_wl" onclick="fqxdd(\''+ret[i].orderId+'\',\''+ret[i].userId+'\');">取消订单</div>';
		            				}
		            				lxzt='weifukuan';
		            			}
		            			else lxzt='jinxingzhong';
	            			}
	            			if(ret[i].orderStatus==1)
	            			{
	            				if(ret[i].zt==1 || ret[i].zt==4)
	            				{
	            					if(ret[i].isRefund==0)
	            					{
	            						//申请退款，确认收货
	            						html2='<div tapmode="del_on" class="del" onclick="fqueren(\''+ret[i].orderId+'\',\''+ret[i].userId+'\');">确认收货</div>';
	            						html2+='<div tapmode="look_wl_on" class="look_wl" onclick="fsqtk(\''+ret[i].orderId+'\',\''+ret[i].userId+'\');">申请退款</div>';
	            					}
	            					else if(ret[i].isRefund==3)
	            					{
	            						//申请平台介入，取消退款
	            						html2='<div tapmode="del_on" class="del" onclick="fqxtk(\''+ret[i].orderId+'\',\''+ret[i].userId+'\');">取消退款</div>';
	            						html2+='<div tapmode="look_wl_on" class="look_wl" onclick="fsqptjr(\''+ret[i].orderId+'\',\''+ret[i].userId+'\');">申请平台介入</div>';
	            					}
	            					lxzt='jinxingzhong';
	            				}
	            				else
	            				{
	            					//取消，完成微帮
	            					html2='<div tapmode="del_on" class="del" onclick="fover(\''+ret[i].orderId+'\',\''+ret[i].userId+'\');">已完成微帮</div>';
	            					html2+='<div tapmode="look_wl_on" class="look_wl" onclick="fqxdd(\''+ret[i].orderId+'\',\''+ret[i].userId+'\');">取消订单</div>';
	            					lxzt='jinxingzhong';
	            				}
	            			}
	            			if(ret[i].orderStatus==2)
	            			{
	            				if(ret[i].zt==1 || ret[i].zt==4)
	            				{
	            					if(ret[i].isRefund==0)
	            					{
	            						//申请退款，确认收货
	            						html2='<div tapmode="del_on" class="del" onclick="fqueren(\''+ret[i].orderId+'\',\''+ret[i].userId+'\');">确认收货</div>';
	            						html2+='<div tapmode="look_wl_on" class="look_wl" onclick="fsqtk(\''+ret[i].orderId+'\',\''+ret[i].userId+'\');">申请退款</div>';
	            						lxzt='jinxingzhong';
	            					}
	            					else if(ret[i].isRefund==3)
	            					{
	            						//申请平台介入，取消退款
	            						html2='<div tapmode="del_on" class="del" onclick="fqxtk(\''+ret[i].orderId+'\',\''+ret[i].userId+'\');">取消退款</div>';
	            						html2+='<div tapmode="look_wl_on" class="look_wl" onclick="fsqptjr(\''+ret[i].orderId+'\',\''+ret[i].userId+'\');">申请平台介入</div>';
	            						lxzt='jinxingzhong';
	            					}
	            				}
	            				else
	            				{
	            					html2='';//无需按钮
	            					lxzt='jinxingzhong';
	            				}
	            			}
	            			if(ret[i].orderStatus==3)
	            			{
	            				if(ret[i].zt==1 || ret[i].zt==4)
	            				{
	            					//评价
	            					html2='<div tapmode="del_on" class="del" onclick="fopen_wb_pingjia('+ret[i].helpId+');">评价</div>';
	            					lxzt='yiwancheng';
	            				}
	            				else
	            				{
	            					html2='';//订单完成，无需按钮
	            					lxzt='yiwancheng';
	            				}
	            			}
	            			if(ret[i].orderStatus==-1)
	            			{
	            				html2='';//已取消订单
	            				lxzt='yiwancheng';
	            			}
	            			if(ret[i].orderStatus==-2)
	            			{
	            				if(ret[i].isRefund==2)
	            				{
	            					html2='';//退款成功
	            					lxzt='yiwancheng';
	            				}
	            			}
	            			if(ret[i].orderStatus==-3 ||　ret[i].orderStatus==-4)
	            			{
	            				if(ret[i].zt==1 || ret[i].zt==4)
	            				{
	            					if(ret[i].isRefund==1)
	            					{
	            						html2='';//无需按钮
	            					}
	            					lxzt='jinxingzhong';
	            				}
	            				else
	            				{
	            					if(ret[i].isRefund==1)
	            					{
	            						//同意退库啊，拒绝退款
	            						html2='<div tapmode="del_on" class="del" onclick="ftytk(\''+ret[i].orderId+'\',\''+ret[i].userId+'\');">同意退款</div>';
	            						html2+='<div tapmode="look_wl_on" class="look_wl" onclick="fjjtk(\''+ret[i].orderId+'\',\''+ret[i].userId+'\');">拒绝退款</div>';
	            					}
	            					lxzt='jinxingzhong';
	            				}
	            			}
	            			if(ret[i].orderStatus==-5)
	            			{
	            				if(ret[i].isRefund==2)
	            				{
	            					html2='';//服务方同意退款
	            					lxzt='yiwancheng';
	            				}
	            			}
	            			if(ret[i].orderStatus==-6)
	            			{
	            				if(ret[i].isRefund==4)
	            				{
	            					html2='';//平台同意退款
	            					lxzt='yiwancheng';
	            				}
	            			}
	            			if(ret[i].orderStatus==-7 || ret[i].orderStatus==-8)
	            			{
	            				if(ret[i].isRefund==-1)
	            				{
	            					//平台处理中，无需按钮
	            					lxzt='jinxingzhong';
	            				}
	            			}
	            			
	            			html+='<div class="shangjia '+lxzt+'">';
							html+='	<div class="min-title">';
							html+='		<span class="t2" style="background-image:url(\''+YAH_web+'/'+ret[i].userPhoto+'\')"></span><span class="t1">'+ret[i].userName+'</span><span class="t4">'+ret[i].msg+'</span>';
							html+='	</div>';
							html+='	<div class="goods goods2" tapmode="a0" onclick="fopen_weibang_dd(\''+ret[i].zt+'\',\''+ret[i].orderId+'\',\''+ret[i].isPay+'\');">';
							html+='		<div class="title2 ccyc">'+ret[i].title+'</div>';
							html+='		<div class="con">'+ret[i].content+'</div>';
							html+='	</div>';
							html+='	<div class="caozuo">';
							html+=html2;
							//html+='		<div tapmode="del_on" class="del" onclick="fopen_pingjia('+ret[i].orderId+');">去评价</div>';
							//html+='		<div tapmode="look_wl_on" class="look_wl" onclick="fopen_pingjia('+ret[i].orderId+');">申请退款</div>';
							
							html+='		<div tapmode="a" class="pinglun">价钱：￥'+ret[i].needPay+'</div>';
							html+='	</div>';
							html+='</div>';
	            		}
	            	}
	                //document.getElementById("main").innerHTML=html;
	                //if(ret.length==0) document.getElementById("main").innerHTML='<div style="text-align: center;line-height: 50px;">暂无订单</div>';
	                if(page==0) $('#main').html(html);
					 else
					 {
					 	$('.jiazai').remove();
					 	$('#main').append(html);
					 }
					 if(ret.length>0) page+=ret.length;
					 if(ret.length<10)
					 {
					 	$('#main').append('<div class="no_data">没有更多数据</div>');
					 	page=-1;
					 } 
					 else $('#main').append('<div class="add_data" tapmode="add_data_on" onclick="fget_all_dingdan();">加载更多>></div>');
					 
	                api.parseTapmode();
	            }else {
	            	//fduanwang();
	            	document.getElementById("main").innerHTML='<div style="text-align: center;line-height: 50px;">暂无订单</div>';
//					api.alert({
//		                msg:('错误码：'+err.code+'；错误信息：'+err.msg+'网络状态码：'+err.statusCode)
//		            });
	            };
	            api.refreshHeaderLoadDone();
	            api.hideProgress();//隐藏加载进度框
	        });
	}
	function fquerenshouhuo_pan(orderId)
	{
		api.confirm({
		    title: '提示',
		    msg: '您是否已收到该订单商品？',
		    buttons: ['未收货', '已收货']
		},function( ret, err ){
		    if( ret ){
		    	if(ret.buttonIndex == 2)
		    	{
		    		fquerenshouhuo(orderId);
		    	}
		    }else{
		         //alert( JSON.stringify( err ) );
		    }
		});
	}
	function fdel_order_pan(orderId)
	{
		api.confirm({
		    title: '提示',
		    msg: '确定要删除该订单吗？',
		    buttons: ['取消', '删除']
		},function( ret, err ){
		    if( ret ){
		    	if(ret.buttonIndex == 2)
		    	{
		    		fdel_order(orderId);
		    	}
		    }else{
		         //alert( JSON.stringify( err ) );
		    }
		});
	}
	function fdel_order(orderId)
	{
		api.showProgress({title:'删除订单中...'});
		var user_id=$api.getStorage('user_id');
		//alert(user_id+" "+orderId);
		api.ajax({
	            url: YAH_ajax_name+'del_order.php',
	            method: 'post',
	            cache: false,
	            timeout: 30,
	            dataType: 'json',
	            returnAll:false,
	            data:{
	                values: {
	                	orderId:orderId,
	                	user_id:user_id
	                }
	            }
	        },function(ret,err){
	        	api.hideProgress();//隐藏加载进度框
	            if (ret) {
	                 if(ret[0].pan==1)
	                 {
	                 	api.toast({
							    msg: '删除成功',
							    duration: 2000,
							    location: 'bottom'
						});
//						api.execScript({
//		                   	name:'root',
//		                   	frameName:'my',
//		                    script: 'fget_dingdan_number();'
//	                    });
						fset_page();
						fget_all_dingdan();
	                 }
	                 else
	                 {
	                 	api.toast({
							    msg: '删除失败！请稍后再试',
							    duration: 2000,
							    location: 'bottom'
						});
	                 }
	            }else {
	            	//fduanwang();
	            	api.toast({
							    msg: '删除失败！请稍后再试',
							    duration: 2000,
							    location: 'bottom'
					});
	//				api.alert({
	//	                msg:('错误码：'+err.code+'；错误信息：'+err.msg+'网络状态码：'+err.statusCode)
	//	            });
	            };
	        });
	}
	function fquerenshouhuo(orderId)
	{
			api.showProgress({title:'确认收货中...'});
			var user_id=$api.getStorage('user_id');
			api.ajax({
	            url: YAH_ajax_name+'set_orderStatus.php',
	            method: 'post',
	            cache: false,
	            timeout: 30,
	            dataType: 'text',
	            returnAll:false,
	            data:{
	                values: {
	                	orderId:orderId,
	                	user_id:user_id,
	                	status:'4'
	                }
	            }
	        },function(ret,err){
	        	api.hideProgress();//隐藏加载进度框
	            if (ret) {
	                 if(ret=='true')
	                 {
	                 	api.toast({
							    msg: '已确认',
							    duration: 2000,
							    location: 'bottom'
						});
						api.execScript({
		                   	name:'root',
		                   	frameName:'my',
		                    script: 'fget_dingdan_number();'
	                    });
						fget_all_dingdan();
	                 }
	                 else
	                 {
	                 	api.toast({
							    msg: '确认失败',
							    duration: 2000,
							    location: 'bottom'
						});
	                 }
	            }else {
	            	fduanwang();
	//				api.alert({
	//	                msg:('错误码：'+err.code+'；错误信息：'+err.msg+'网络状态码：'+err.statusCode)
	//	            });
	            };
	        });
	}
	function fopen_dingdan_xx(orderId)
	{
		api.openWin({
	        name: 'dingdan_xx2_header',
	        url: 'dingdan_xx2_header.html',
	        pageParam:{
	        	id:orderId
	        }
        });
	}
	function fopen_pingjia(orderId)
	{
		api.openWin({
	        name: 'pingjia_header',
	        url: 'pingjia_header.html',
	        pageParam:{
	        	orderId:orderId
	        }
        });
	}
	function fquxiao_pan(orderId)
	{
		api.confirm({
		    title: '提示',
		    msg: '确定取消该订单吗？',
		    buttons: ['确定', '取消']
		},function( ret, err ){
		    if( ret ){
		    	if(ret.buttonIndex == 1)
		    	{
		    		fquxiao(orderId);
		    	}
		    }else{
		         //alert( JSON.stringify( err ) );
		    }
		});
	}
	function fquxiao(orderId)
	{
			api.showProgress({title:'取消中...'});
			var user_id=$api.getStorage('user_id');
			api.ajax({
	            url: YAH_ajax_name+'set_orderStatus.php',
	            method: 'post',
	            cache: false,
	            timeout: 30,
	            dataType: 'text',
	            returnAll:false,
	            data:{
	                values: {
	                	orderId:orderId,
	                	user_id:user_id,
	                	status:'-1'
	                }
	            }
	        },function(ret,err){
	        	api.hideProgress();//隐藏加载进度框
	            if (ret) {
	                 if(ret=='true')
	                 {
	                 	api.toast({
							    msg: '已取消',
							    duration: 2000,
							    location: 'bottom'
						});
						api.execScript({
		                   	name:'root',
		                   	frameName:'my',
		                    script: 'fget_dingdan_number();'
	                    });
	                    fget_all_dingdan();
						fxuan(0,'全部');
						//fget_dingdan_xx();
	                 }
	                 else
	                 {
	                 	api.toast({
							    msg: '取消失败',
							    duration: 2000,
							    location: 'bottom'
						});
	                 }
	            }else {
	            	fduanwang();
	//				api.alert({
	//	                msg:('错误码：'+err.code+'；错误信息：'+err.msg+'网络状态码：'+err.statusCode)
	//	            });
	            };
	        });
	}
	function ftuikuan_pan(orderId)
	{
		api.confirm({
		    title: '提示',
		    msg: '确定要退款吗？',
		    buttons: ['确定', '取消']
		},function( ret, err ){
		    if( ret ){
		    	if(ret.buttonIndex == 1)
		    	{
		    		ftuikuan(orderId);
		    	}
		    }else{
		         //alert( JSON.stringify( err ) );
		    }
		});
	}
	function ftuikuan(orderId)
	{
		api.openWin({
	        name: 'tuikuan_header',
	        url: 'tuikuan_header.html',
	        pageParam:{
	        	orderId:orderId
	        }
        });
	}
	function fopen_tuikuan_xx(orderId)
	{
		api.openWin({
	        name: 'tuikuan_xx_header',
	        url: 'tuikuan_xx_header.html',
	        pageParam:{
	        	orderId:orderId
	        }
        });
	}
	function fopen_weibang_dd(zt,order_id,isPay)
	{
		api.openWin({
	        name: 'weibang_dingdan_header',
	        url: 'weibang_dingdan_header.html',
	        pageParam:{
	        	order_id:order_id,
	        	zt:zt,
	        	isPay:isPay
	        }
        });
	}
	/**********************/
	function fsqptjr(order_id,to_user_id)
	{
		//alert("申请平台介入");
		api.showProgress({title:'提交中...'});
		var user_id=$api.getStorage('user_id');
			api.ajax({
	            url: YAH_ajax_name+'set_wb_order_xx.php',
	            method: 'post',
	            cache: false,
	            timeout: 30,
	            dataType: 'json',
	            returnAll:false,
	            data:{
	                values: {
	                	order_id:order_id,
	                	status:'ptjr',
	                	user_id:user_id,
	                	to_user_id:to_user_id
	                }
	            }
	        },function(ret,err){
	            if (ret) {
	            	//alert(ret);
	            	if(ret[0].pan==-1)
	            	{
	            		api.toast({
							msg: ret[0].msg,
							duration: 2000,
							location: 'bottom'
						});
	            	}
	            	else if(ret[0].pan==1)
	            	{
	            		api.toast({
							msg: ret[0].msg,
							duration: 2000,
							location: 'bottom'
						});
						fget_all_dindan();
	            	}
					api.parseTapmode();
	            }else {
	            	fduanwang();
//					api.alert({
//		                msg:('错误码：'+err.code+'；错误信息：'+err.msg+'网络状态码：'+err.statusCode)
//		            });
	            };
	            api.refreshHeaderLoadDone();
	        	api.hideProgress();//隐藏加载进度框
	        });
	}
	function ftytk(order_id,to_user_id)
	{
		//alert("同意退款");
		api.showProgress({title:'提交中...'});
		var user_id=$api.getStorage('user_id');
			api.ajax({
	            url: YAH_ajax_name+'set_wb_order_xx.php',
	            method: 'post',
	            cache: false,
	            timeout: 30,
	            dataType: 'json',
	            returnAll:false,
	            data:{
	                values: {
	                	order_id:order_id,
	                	status:'tytk',
	                	user_id:user_id,
	                	to_user_id:to_user_id
	                }
	            }
	        },function(ret,err){
	            if (ret) {
	            	//alert(ret);
	            	if(ret[0].pan==-1)
	            	{
	            		api.toast({
							msg: ret[0].msg,
							duration: 2000,
							location: 'bottom'
						});
	            	}
	            	else if(ret[0].pan==1)
	            	{
	            		api.toast({
							msg: ret[0].msg,
							duration: 2000,
							location: 'bottom'
						});
						$('#tytk').css('display','none');
						$('#jjtk').css('display','none');
						fcsh();
	            	}
					api.parseTapmode();
	            }else {
	            	fduanwang();
//					api.alert({
//		                msg:('错误码：'+err.code+'；错误信息：'+err.msg+'网络状态码：'+err.statusCode)
//		            });
	            };
	            api.refreshHeaderLoadDone();
	        	api.hideProgress();//隐藏加载进度框
	        });
	}
	function fjjtk(order_id,to_user_id)
	{
		//alert("拒绝退款");	
		api.showProgress({title:'提交中...'});
		var user_id=$api.getStorage('user_id');
			api.ajax({
	            url: YAH_ajax_name+'set_wb_order_xx.php',
	            method: 'post',
	            cache: false,
	            timeout: 30,
	            dataType: 'json',
	            returnAll:false,
	            data:{
	                values: {
	                	order_id:order_id,
	                	status:'jjtk',
	                	user_id:user_id,
	                	to_user_id:to_user_id
	                }
	            }
	        },function(ret,err){
	            if (ret) {
	            	//alert(ret);
	            	if(ret[0].pan==-1)
	            	{
	            		api.toast({
							msg: ret[0].msg,
							duration: 2000,
							location: 'bottom'
						});
	            	}
	            	else if(ret[0].pan==1)
	            	{
	            		api.toast({
							msg: ret[0].msg,
							duration: 2000,
							location: 'bottom'
						});
						fget_all_dingdan();
	            	}
					api.parseTapmode();
	            }else {
	            	fduanwang();
//					api.alert({
//		                msg:('错误码：'+err.code+'；错误信息：'+err.msg+'网络状态码：'+err.statusCode)
//		            });
	            };
	            api.refreshHeaderLoadDone();
	        	api.hideProgress();//隐藏加载进度框
	        });
	}
	function fqxtk(order_id,to_user_id)
	{
		api.showProgress({title:'提交中...'});
		var user_id=$api.getStorage('user_id');
			api.ajax({
	            url: YAH_ajax_name+'set_wb_order_xx.php',
	            method: 'post',
	            cache: false,
	            timeout: 30,
	            dataType: 'json',
	            returnAll:false,
	            data:{
	                values: {
	                	order_id:order_id,
	                	status:'qxtk',
	                	user_id:user_id,
	                	to_user_id:to_user_id
	                }
	            }
	        },function(ret,err){
	            if (ret) {
	            	if(ret[0].pan==-1)
	            	{
	            		api.toast({
							msg: ret[0].msg,
							duration: 2000,
							location: 'bottom'
						});
	            	}
	            	else if(ret[0].pan==1)
	            	{
	            		api.toast({
							msg: ret[0].msg,
							duration: 2000,
							location: 'bottom'
						});
						fget_all_dingdan();
	            	}
					api.parseTapmode();
	            }else {
	            	fduanwang();
//					api.alert({
//		                msg:('错误码：'+err.code+'；错误信息：'+err.msg+'网络状态码：'+err.statusCode)
//		            });
	            };
	            api.refreshHeaderLoadDone();
	        	api.hideProgress();//隐藏加载进度框
	        });
	}
	function fsqtk(order_id,to_user_id)
	{
		api.showProgress({title:'提交中...'});
		var user_id=$api.getStorage('user_id');
			api.ajax({
	            url: YAH_ajax_name+'set_wb_order_xx.php',
	            method: 'post',
	            cache: false,
	            timeout: 30,
	            dataType: 'json',
	            returnAll:false,
	            data:{
	                values: {
	                	order_id:order_id,
	                	status:'sqtk',
	                	user_id:user_id,
	                	to_user_id:to_user_id
	                }
	            }
	        },function(ret,err){
	            if (ret) {
	            	//alert(ret);
	            	if(ret[0].pan==-1)
	            	{
	            		api.toast({
							msg: ret[0].msg,
							duration: 2000,
							location: 'bottom'
						});
	            	}
	            	else if(ret[0].pan==1)
	            	{
	            		api.toast({
							msg: ret[0].msg,
							duration: 2000,
							location: 'bottom'
						});
						fget_all_dingdan();
	            	}
					api.parseTapmode();
	            }else {
	            	fduanwang();
//					api.alert({
//		                msg:('错误码：'+err.code+'；错误信息：'+err.msg+'网络状态码：'+err.statusCode)
//		            });
	            };
	            api.refreshHeaderLoadDone();
	        	api.hideProgress();//隐藏加载进度框
	        });
	}
	function fqxdd(order_id,to_user_id)
	{
		api.showProgress({title:'提交中...'});
		var user_id=$api.getStorage('user_id');
			api.ajax({
	            url: YAH_ajax_name+'set_wb_order_xx.php',
	            method: 'post',
	            cache: false,
	            timeout: 30,
	            dataType: 'json',
	            returnAll:false,
	            data:{
	                values: {
	                	order_id:order_id,
	                	status:'qx',
	                	user_id:user_id,
	                	to_user_id:to_user_id
	                }
	            }
	        },function(ret,err){
	            if (ret) {
	            	//alert(ret);
	            	if(ret[0].pan==-1)
	            	{
	            		api.toast({
							msg: ret[0].msg,
							duration: 2000,
							location: 'bottom'
						});
	            	}
	            	else if(ret[0].pan==1)
	            	{
	            		api.toast({
							msg: ret[0].msg,
							duration: 2000,
							location: 'bottom'
						});
						fget_all_dingdan();
	            	}
					api.parseTapmode();
	            }else {
	            	fduanwang();
//					api.alert({
//		                msg:('错误码：'+err.code+'；错误信息：'+err.msg+'网络状态码：'+err.statusCode)
//		            });
	            };
	            api.refreshHeaderLoadDone();
	        	api.hideProgress();//隐藏加载进度框
	        });
	}
	function fover(order_id,to_user_id)
	{
		//api.pageParam.order_id
		api.showProgress({title:'提交中...'});
		var user_id=$api.getStorage('user_id');
			api.ajax({
	            url: YAH_ajax_name+'set_wb_order_xx.php',
	            method: 'post',
	            cache: false,
	            timeout: 30,
	            dataType: 'json',
	            returnAll:false,
	            data:{
	                values: {
	                	order_id:order_id,
	                	status:2,
	                	user_id:user_id,
	                	to_user_id:to_user_id
	                }
	            }
	        },function(ret,err){
	            if (ret) {
	            	if(ret[0].pan==-1)
	            	{
	            		api.toast({
							msg: '提交失败',
							duration: 2000,
							location: 'bottom'
						});
	            	}
	            	else if(ret[0].pan==1)
	            	{
	            		api.toast({
							msg: '提交成功',
							duration: 2000,
							location: 'bottom'
						});
						fget_all_dindan();
	            	}
					api.parseTapmode();
	            }else {
	            	fduanwang();
//					api.alert({
//		                msg:('错误码：'+err.code+'；错误信息：'+err.msg+'网络状态码：'+err.statusCode)
//		            });
	            };
	            api.refreshHeaderLoadDone();
	        	api.hideProgress();//隐藏加载进度框
	        });
	}
	function fqueren(order_id,to_user_id)
	{
		//api.pageParam.order_id
		//api.pageParam.order_id
		api.showProgress({title:'提交中...'});
		var user_id=$api.getStorage('user_id');
			api.ajax({
	            url: YAH_ajax_name+'set_wb_order_xx.php',
	            method: 'post',
	            cache: false,
	            timeout: 30,
	            dataType: 'json',
	            returnAll:false,
	            data:{
	                values: {
	                	order_id:order_id,
	                	status:3,
	                	user_id:user_id,
	                	to_user_id:to_user_id
	                }
	            }
	        },function(ret,err){
	            if (ret) {
	            	//alert(ret);
	            	if(ret[0].pan==-1)
	            	{
	            		api.toast({
							msg: '提交失败',
							duration: 2000,
							location: 'bottom'
						});
	            	}
	            	else if(ret[0].pan==1)
	            	{
	            		api.toast({
							msg: '提交成功',
							duration: 2000,
							location: 'bottom'
						});
						fget_all_dingdan();
	            	}
					api.parseTapmode();
	            }else {
	            	fduanwang();
//					api.alert({
//		                msg:('错误码：'+err.code+'；错误信息：'+err.msg+'网络状态码：'+err.statusCode)
//		            });
	            };
	            api.refreshHeaderLoadDone();
	        	api.hideProgress();//隐藏加载进度框
	        });
	}
	function fopen_wb_pingjia(wb_id2)
	{
		api.openWin({
	        name: 'wb_pingjia_header',
	        url: 'wb_pingjia_header.html',
	        pageParam:{
	        	wb_id:wb_id2
	        }
        });
	}
	function fgo_pay_wb(order_id)
	{
		api.openWin({
	        name: 'zhifu_header',
	        url: 'zhifu_header.html',
	        pageParam:{
	        	zhifupan:'wb_xq',
	        	wb_order_id:order_id
	        }
        });
	}
	/**********************/
</script>
</html>